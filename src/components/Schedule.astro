---
import { supabase } from '../lib/supabase';

// Fetch active schedules
const { data: schedulesData, error } = await supabase
  .from('schedules')
  .select('*')
  .eq('active', true)
  .order('day_of_week', { ascending: true })
  .order('start_time', { ascending: true });

const schedules = schedulesData || [];

// Group schedules by day
const dayNames = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];

const schedulesByDay = schedules.reduce((acc: any, schedule: any) => {
  const day = dayNames[schedule.day_of_week];
  if (!acc[day]) {
    acc[day] = [];
  }
  acc[day].push(schedule);
  return acc;
}, {});
---

<section id="horarios" class="section bg-dark">
  <div class="container">
    <div class="section-header text-center fade-in-up">
      <span class="section-badge-light">Horarios</span>
      <h2 class="section-title text-white">Entrenamientos Semanales</h2>
      <p class="section-subtitle text-white" style="opacity: 0.8;">
        Encuentra el horario perfecto para ti y tu familia
      </p>
    </div>

    <div class="schedule-container">
      {Object.keys(schedulesByDay).length > 0 ? (
        <div class="schedule-grid stagger-container">
          {Object.entries(schedulesByDay).map(([day, daySchedules]: [string, any]) => (
            <div class="schedule-day-card card-glass stagger-item">
              <h3 class="schedule-day-name">{day}</h3>
              <div class="schedule-items">
                {daySchedules.map((schedule: any) => (
                  <div class="schedule-item">
                    <div class="schedule-time">
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M8 4V8L10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                      </svg>
                      <span>{schedule.start_time.slice(0, 5)} - {schedule.end_time.slice(0, 5)}</span>
                    </div>
                    <div class="schedule-group">{schedule.group_name}</div>
                    {schedule.location && (
                      <div class="schedule-location">
                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                          <path d="M7 1C4.79 1 3 2.79 3 5C3 7.5 7 13 7 13C7 13 11 7.5 11 5C11 2.79 9.21 1 7 1ZM7 6.5C6.17 6.5 5.5 5.83 5.5 5C5.5 4.17 6.17 3.5 7 3.5C7.83 3.5 8.5 4.17 8.5 5C8.5 5.83 7.83 6.5 7 6.5Z" fill="currentColor"/>
                        </svg>
                        {schedule.location}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div class="schedule-grid stagger-container">
          <div class="schedule-day-card card-glass stagger-item">
            <h3 class="schedule-day-name">Lunes</h3>
            <div class="schedule-items">
              <div class="schedule-item">
                <div class="schedule-time">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M8 4V8L10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <span>17:00 - 18:30</span>
                </div>
                <div class="schedule-group">Infantil</div>
                <div class="schedule-location">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <path d="M7 1C4.79 1 3 2.79 3 5C3 7.5 7 13 7 13C7 13 11 7.5 11 5C11 2.79 9.21 1 7 1ZM7 6.5C6.17 6.5 5.5 5.83 5.5 5C5.5 4.17 6.17 3.5 7 3.5C7.83 3.5 8.5 4.17 8.5 5C8.5 5.83 7.83 6.5 7 6.5Z" fill="currentColor"/>
                  </svg>
                  Piscina UCAM
                </div>
              </div>
              <div class="schedule-item">
                <div class="schedule-time">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M8 4V8L10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <span>18:30 - 20:00</span>
                </div>
                <div class="schedule-group">Juvenil</div>
                <div class="schedule-location">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <path d="M7 1C4.79 1 3 2.79 3 5C3 7.5 7 13 7 13C7 13 11 7.5 11 5C11 2.79 9.21 1 7 1ZM7 6.5C6.17 6.5 5.5 5.83 5.5 5C5.5 4.17 6.17 3.5 7 3.5C7.83 3.5 8.5 4.17 8.5 5C8.5 5.83 7.83 6.5 7 6.5Z" fill="currentColor"/>
                  </svg>
                  Piscina UCAM
                </div>
              </div>
            </div>
          </div>

          <div class="schedule-day-card card-glass stagger-item">
            <h3 class="schedule-day-name">Miércoles</h3>
            <div class="schedule-items">
              <div class="schedule-item">
                <div class="schedule-time">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M8 4V8L10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <span>17:00 - 18:30</span>
                </div>
                <div class="schedule-group">Infantil</div>
                <div class="schedule-location">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <path d="M7 1C4.79 1 3 2.79 3 5C3 7.5 7 13 7 13C7 13 11 7.5 11 5C11 2.79 9.21 1 7 1ZM7 6.5C6.17 6.5 5.5 5.83 5.5 5C5.5 4.17 6.17 3.5 7 3.5C7.83 3.5 8.5 4.17 8.5 5C8.5 5.83 7.83 6.5 7 6.5Z" fill="currentColor"/>
                  </svg>
                  Piscina UCAM
                </div>
              </div>
              <div class="schedule-item">
                <div class="schedule-time">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M8 4V8L10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <span>18:30 - 20:00</span>
                </div>
                <div class="schedule-group">Juvenil</div>
                <div class="schedule-location">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <path d="M7 1C4.79 1 3 2.79 3 5C3 7.5 7 13 7 13C7 13 11 7.5 11 5C11 2.79 9.21 1 7 1ZM7 6.5C6.17 6.5 5.5 5.83 5.5 5C5.5 4.17 6.17 3.5 7 3.5C7.83 3.5 8.5 4.17 8.5 5C8.5 5.83 7.83 6.5 7 6.5Z" fill="currentColor"/>
                  </svg>
                  Piscina UCAM
                </div>
              </div>
            </div>
          </div>

          <div class="schedule-day-card card-glass stagger-item">
            <h3 class="schedule-day-name">Viernes</h3>
            <div class="schedule-items">
              <div class="schedule-item">
                <div class="schedule-time">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M8 4V8L10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <span>17:00 - 18:30</span>
                </div>
                <div class="schedule-group">Infantil</div>
                <div class="schedule-location">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <path d="M7 1C4.79 1 3 2.79 3 5C3 7.5 7 13 7 13C7 13 11 7.5 11 5C11 2.79 9.21 1 7 1ZM7 6.5C6.17 6.5 5.5 5.83 5.5 5C5.5 4.17 6.17 3.5 7 3.5C7.83 3.5 8.5 4.17 8.5 5C8.5 5.83 7.83 6.5 7 6.5Z" fill="currentColor"/>
                  </svg>
                  Piscina UCAM
                </div>
              </div>
              <div class="schedule-item">
                <div class="schedule-time">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M8 4V8L10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                  </svg>
                  <span>18:30 - 20:00</span>
                </div>
                <div class="schedule-group">Juvenil</div>
                <div class="schedule-location">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                    <path d="M7 1C4.79 1 3 2.79 3 5C3 7.5 7 13 7 13C7 13 11 7.5 11 5C11 2.79 9.21 1 7 1ZM7 6.5C6.17 6.5 5.5 5.83 5.5 5C5.5 4.17 6.17 3.5 7 3.5C7.83 3.5 8.5 4.17 8.5 5C8.5 5.83 7.83 6.5 7 6.5Z" fill="currentColor"/>
                  </svg>
                  Piscina UCAM
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>

    <div class="schedule-cta text-center mt-xl">
      <p class="schedule-cta-text">¿Necesitas un horario personalizado?</p>
      <a href="#contacto" class="btn btn-accent btn-lg">
        Contáctanos
      </a>
    </div>
  </div>
</section>

<style>
  .section-badge-light {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    color: var(--color-white);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 600;
    margin-bottom: var(--space-md);
  }

  .schedule-container {
    max-width: 1000px;
    margin: 0 auto;
  }

  .schedule-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-lg);
  }

  .schedule-day-card {
    padding: var(--space-lg);
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .schedule-day-name {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--color-white);
    margin-bottom: var(--space-md);
    padding-bottom: var(--space-sm);
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
  }

  .schedule-items {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .schedule-item {
    padding: var(--space-sm);
    background: rgba(255, 255, 255, 0.05);
    border-radius: var(--radius-md);
    border-left: 3px solid var(--color-secondary);
  }

  .schedule-time {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    color: var(--color-white);
    font-weight: 600;
    margin-bottom: var(--space-xs);
  }

  .schedule-group {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--color-secondary);
    margin-bottom: var(--space-xs);
  }

  .schedule-location {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: var(--text-sm);
    color: rgba(255, 255, 255, 0.7);
  }

  .schedule-cta-text {
    color: var(--color-white);
    font-size: var(--text-lg);
    margin-bottom: var(--space-md);
  }
</style>
