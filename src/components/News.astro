---
import { supabase } from '../lib/supabase';

// Fetch latest published news
const { data: newsItems, error } = await supabase
  .from('news')
  .select('*')
  .eq('published', true)
  .order('created_at', { ascending: false })
  .limit(3);

const news = newsItems || [];
---

<section id="noticias" class="section bg-light">
  <div class="container">
    <div class="section-header text-center fade-in-up">
      <span class="section-badge">Últimas Noticias</span>
      <h2 class="section-title">Mantente Informado</h2>
      <p class="section-subtitle">
        Descubre las últimas novedades, eventos y logros de nuestro club
      </p>
    </div>

    <div class="grid grid-3 stagger-container">
      {news.length > 0 ? (
        news.map((item) => (
          <article class="card card-animated stagger-item">
            {item.image_url && (
              <img 
                src={item.image_url} 
                alt={item.title}
                class="card-image"
                loading="lazy"
              />
            )}
            <div class="card-content">
              <div class="card-meta">
                <time datetime={item.created_at}>
                  {new Date(item.created_at).toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
              </div>
              <h3 class="card-title">{item.title}</h3>
              <p class="card-text">{item.excerpt}</p>
              <a href={`/noticias/${item.slug}`} class="card-link">
                Leer más
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            </div>
          </article>
        ))
      ) : (
        <div class="news-placeholder stagger-item">
          <article class="card card-animated">
            <img 
              src="https://images.unsplash.com/photo-1530549387789-4c1017266635?w=600&h=400&fit=crop" 
              alt="Piscina de natación"
              class="card-image"
            />
            <div class="card-content">
              <div class="card-meta">
                <time datetime={new Date().toISOString()}>
                  {new Date().toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
              </div>
              <h3 class="card-title">Bienvenidos a UCAM Natación</h3>
              <p class="card-text">
                Estamos emocionados de presentar nuestra nueva plataforma digital. Aquí encontrarás todas las novedades del club.
              </p>
              <a href="/noticias" class="card-link">
                Leer más
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            </div>
          </article>
        </div>
      )}
    </div>

    <div class="section-footer text-center mt-xl">
      <a href="/noticias" class="btn btn-primary">
        Ver Todas las Noticias
      </a>
    </div>
  </div>
</section>

<style>
  .section-header {
    margin-bottom: var(--space-2xl);
  }

  .section-badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: rgba(0, 102, 204, 0.1);
    color: var(--color-primary);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 600;
    margin-bottom: var(--space-md);
  }

  .section-title {
    font-size: var(--text-4xl);
    font-weight: 800;
    color: var(--color-dark);
    margin-bottom: var(--space-sm);
  }

  .section-subtitle {
    font-size: var(--text-lg);
    color: var(--color-gray);
    max-width: 600px;
    margin: 0 auto;
  }

  .card-content {
    padding: var(--space-md);
  }

  .card-meta {
    font-size: var(--text-sm);
    color: var(--color-gray);
    margin-bottom: var(--space-sm);
  }

  .card-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    color: var(--color-primary);
    font-weight: 600;
    text-decoration: none;
    transition: gap var(--transition-base);
  }

  .card-link:hover {
    gap: var(--space-sm);
  }

  .section-footer {
    margin-top: var(--space-2xl);
  }
</style>
